---
import '../styles/global.css';
import { site } from '../utils/config';
import ThemeToggle from '../components/ThemeToggle.astro';

interface Props {
  title?: string;
  description?: string;
  image?: string;
  type?: 'website' | 'article';
  pubDate?: Date;
}

const { 
  title = site.title, 
  description = site.description,
  image = site.ogImage,
  type = 'website',
  pubDate,
} = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, site.url);
const ogImage = new URL(image, site.url);
---

<!DOCTYPE html>
<html lang={site.language}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    
    <title>{title === site.title ? title : `${title} | ${site.title}`}</title>
    <meta name="description" content={description} />
    <link rel="canonical" href={canonicalURL} />
    
    <!-- Open Graph -->
    <meta property="og:type" content={type} />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={ogImage} />
    <meta property="og:site_name" content={site.title} />
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={canonicalURL} />
    <meta property="twitter:title" content={title} />
    <meta property="twitter:description" content={description} />
    <meta property="twitter:image" content={ogImage} />
    
    {type === 'article' && pubDate && (
      <>
        <meta property="article:published_time" content={pubDate.toISOString()} />
        <meta property="article:author" content={site.author} />
      </>
    )}
    
    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" title={site.title} href="/rss.xml" />
    
    <!-- Theme initialization script -->
    <script is:inline>
      (function() {
        const theme = localStorage.getItem('blog-theme') || 'light';
        if (theme === 'dark') {
          document.documentElement.classList.add('dark');
        } else if (theme === 'blue') {
          document.documentElement.classList.add('blue');
        }
      })();
    </script>
  </head>
  
  <body class="min-h-screen">
    <!-- Navigation -->
    <header class="fixed top-0 left-0 right-0 z-50 bg-[var(--color-bg)]/90 backdrop-blur-sm">
      <div class="max-w-6xl mx-auto px-6">
        <div class="flex items-center justify-between h-20">
          <!-- Logo -->
          <a href="/" class="font-serif text-xl tracking-wide text-[var(--color-fg)] hover:opacity-70 transition-opacity">
            {site.title.toUpperCase()}
          </a>
          
          <!-- Center Navigation -->
          <nav class="hidden sm:flex items-center gap-8 absolute left-1/2 -translate-x-1/2">
            <a href="/blog" class="text-sm tracking-widest uppercase text-[var(--color-muted)] hover:text-[var(--color-fg)] transition-colors">
              博客
            </a>
            <a href="/about" class="text-sm tracking-widest uppercase text-[var(--color-muted)] hover:text-[var(--color-fg)] transition-colors">
              关于
            </a>
          </nav>
          
          <!-- Right Actions -->
          <div class="flex items-center gap-2">
            <!-- Mobile Menu Button -->
            <button class="sm:hidden p-2 text-[var(--color-fg)]" aria-label="菜单">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="3" y1="6" x2="21" y2="6"/>
                <line x1="3" y1="12" x2="21" y2="12"/>
                <line x1="3" y1="18" x2="21" y2="18"/>
              </svg>
            </button>
            
            <ThemeToggle />
          </div>
        </div>
      </div>
    </header>
    
    <!-- Main Content -->
    <main class="pt-20">
      <slot />
    </main>
    
    <!-- Footer -->
    <footer class="py-12 mt-20">
      <div class="max-w-6xl mx-auto px-6">
        <div class="flex flex-col sm:flex-row items-center justify-between gap-4 text-sm text-[var(--color-muted)]">
          <p>© {new Date().getFullYear()} {site.author}</p>
          
          <div class="flex items-center gap-6">
            <a href="/rss.xml" class="hover:text-[var(--color-fg)] transition-colors">RSS</a>
            <a href="https://github.com/BaiXious" class="hover:text-[var(--color-fg)] transition-colors">GitHub</a>
          </div>
        </div>
      </div>
    </footer>
  </body>
</html>
