---
---

<button 
  id="search-trigger"
  class="hidden sm:flex items-center gap-2 px-3 py-1.5 text-sm text-[var(--color-muted)] bg-[var(--color-card)] hover:bg-[var(--color-border)] rounded-lg transition-colors"
>
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <circle cx="11" cy="11" r="8"/>
    <path d="m21 21-4.3-4.3"/>
  </svg>
  <span>搜索...</span>
  <span class="text-xs text-[var(--color-muted)] bg-[var(--color-bg)] px-1.5 py-0.5 rounded">⌘K</span>
</button>

<button 
  id="search-trigger-mobile"
  class="sm:hidden p-2 rounded-lg text-[var(--color-muted)] hover:text-[var(--color-fg)] hover:bg-[var(--color-card)] transition-colors"
  aria-label="搜索"
>
  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <circle cx="11" cy="11" r="8"/>
    <path d="m21 21-4.3-4.3"/>
  </svg>
</button>

<!-- Search Modal -->
<div id="search-modal" class="fixed inset-0 z-[100] hidden">
  <!-- Backdrop -->
  <div id="search-backdrop" class="absolute inset-0 bg-black/50 backdrop-blur-sm"></div>
  
  <!-- Modal Content -->
  <div class="relative flex items-start justify-center pt-[10vh] px-4">
    <div class="w-full max-w-2xl bg-[var(--color-bg)] rounded-xl shadow-2xl border border-[var(--color-border)] overflow-hidden">
      <div id="search-container" class="p-4">
        <!-- Pagefind will inject search UI here -->
        <div class="flex items-center justify-between mb-4">
          <div class="flex items-center gap-2 text-[var(--color-muted)]">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="11" cy="11" r="8"/>
              <path d="m21 21-4.3-4.3"/>
            </svg>
            <span>搜索文章...</span>
          </div>
          
          <button id="search-close" class="text-[var(--color-muted)] hover:text-[var(--color-fg)] transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M18 6 6 18"/>
              <path d="m6 6 12 12"/>
            </svg>
          </button>
        </div>
        
        <div id="pagefind-search" data-pagefind-search></div>
      </div>
    </div>
  </div>
</div>

<script>
  const searchModal = document.getElementById('search-modal');
  const searchBackdrop = document.getElementById('search-backdrop');
  const searchClose = document.getElementById('search-close');
  const searchTrigger = document.getElementById('search-trigger');
  const searchTriggerMobile = document.getElementById('search-trigger-mobile');
  
  function openSearch() {
    searchModal.classList.remove('hidden');
    document.body.style.overflow = 'hidden';
    
    // Focus on search input after modal opens
    setTimeout(() => {
      const searchInput = document.querySelector('.pagefind-ui__search-input');
      if (searchInput) {
        searchInput.focus();
      }
    }, 100);
  }
  
  function closeSearch() {
    searchModal.classList.add('hidden');
    document.body.style.overflow = '';
  }
  
  // Event listeners
  searchTrigger?.addEventListener('click', openSearch);
  searchTriggerMobile?.addEventListener('click', openSearch);
  searchClose?.addEventListener('click', closeSearch);
  searchBackdrop?.addEventListener('click', closeSearch);
  
  // Keyboard shortcuts
  document.addEventListener('keydown', (e) => {
    // Cmd/Ctrl + K to open
    if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
      e.preventDefault();
      if (searchModal.classList.contains('hidden')) {
        openSearch();
      } else {
        closeSearch();
      }
    }
    
    // Escape to close
    if (e.key === 'Escape' && !searchModal.classList.contains('hidden')) {
      closeSearch();
    }
  });
</script>

<style is:global>
  /* Pagefind UI Customization */
  .pagefind-ui {
    --pagefind-ui-scale: 1;
    --pagefind-ui-primary: var(--color-accent);
    --pagefind-ui-text: var(--color-fg);
    --pagefind-ui-background: var(--color-bg);
    --pagefind-ui-border: var(--color-border);
    --pagefind-ui-tag: var(--color-card);
    --pagefind-ui-border-width: 1px;
    --pagefind-ui-border-radius: 8px;
    --pagefind-ui-image-border-radius: 8px;
    --pagefind-ui-image-box-ratio: 3 / 2;
    --pagefind-ui-font: inherit;
  }
  
  .pagefind-ui__search-input {
    background-color: var(--color-card) !important;
    border-color: var(--color-border) !important;
    color: var(--color-fg) !important;
    padding: 0.75rem 1rem !important;
    border-radius: 0.5rem !important;
  }
  
  .pagefind-ui__search-input:focus {
    border-color: var(--color-accent) !important;
    outline: 2px solid var(--color-accent) !important;
    outline-offset: -2px !important;
  }
  
  .pagefind-ui__result {
    border-color: var(--color-border) !important;
  }
  
  .pagefind-ui__result-link {
    color: var(--color-accent) !important;
  }
  
  .pagefind-ui__result-excerpt {
    color: var(--color-muted) !important;
  }
  
  .pagefind-ui__button {
    background-color: var(--color-card) !important;
    border-color: var(--color-border) !important;
    color: var(--color-fg) !important;
  }
  
  .pagefind-ui__button:hover {
    background-color: var(--color-border) !important;
  }
</style>
